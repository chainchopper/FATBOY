<div class="profile-container">
  <div *ngIf="profile$ | async as profile; else notFound">
    <div class="profile-card">
      <div class="profile-header">
        <img [src]="profile.avatar_url || 'https://api.dicebear.com/8.x/initials/svg?seed=' + (profile.first_name || 'A')" alt="User Avatar" class="avatar">
        <button *ngIf="isCurrentUserProfile" class="edit-profile-btn" routerLink="/profile/edit">Edit Profile</button>
      </div>
      <h2>{{ profile.first_name }} {{ profile.last_name }}</h2>
      <p *ngIf="isCurrentUserProfile" class="email">{{ profile.id }}</p> <!-- Email is not on the public profile table -->
      
      <div class="profile-section stats-section" *ngIf="(leaderboardStats$ | async) as stats">
        <div class="stat-item">
          <span class="stat-value">{{ stats.rank || 'N/A' }}</span>
          <span class="stat-label">Global Rank</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ stats.score || 0 }}</span>
          <span class="stat-label">Total Score</span>
        </div>
        <button class="leaderboard-btn" routerLink="/leaderboard">View Leaderboard</button>
      </div>

      <div class="profile-section">
        <h3>{{ isCurrentUserProfile ? 'Your' : profile.first_name + "'s" }} Badges</h3>
        <div class="badges-grid">
          <div *ngFor="let badge of (badges$ | async)" class="badge-item" [class.unlocked]="badge.unlocked">
            <span class="badge-icon">{{ badge.icon }}</span>
            <span class="badge-name">{{ badge.name }}</span>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
  <ng-template #notFound>
    <div class="empty-state">
      <p>User profile not found or you are not logged in.</p>
    </div>
  </ng-template>
</div>