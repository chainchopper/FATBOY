<div class="history-container p-5 max-w-5xl mx-auto text-gray-100">
  <div class="history-header flex justify-between items-center mb-5">
    <h2 class="text-3xl font-bold text-teal-400 drop-shadow-lg shadow-teal-400">Your Scan History</h2>
    <app-button variant="destructive" (onClick)="clearHistory()" class="clear-btn">Clear All Scans</app-button>
  </div>

  <div class="search-section mb-8">
    <div class="flex gap-2">
      <app-input 
        type="text" 
        [(ngModel)]="searchQuery" 
        placeholder="Ask about your products (e.g., 'low calorie snacks')..."
        (keyup.enter)="performSearch()"
        class="flex-grow">
      </app-input>
      <app-button (onClick)="performSearch()" [disabled]="isSearching">
        {{ isSearching ? 'Searching...' : 'AI Search' }}
      </app-button>
    </div>
  </div>

  <div class="stats-section bg-gray-900/80 p-5 rounded-xl mb-5 border border-gray-700" *ngIf="stats.length > 0">
    <h3 class="text-xl font-semibold text-purple-400 mb-4 border-b border-gray-700 pb-3">Most Frequently Avoided Ingredients</h3>
    <div class="stats-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mt-4">
      <div *ngFor="let stat of stats.slice(0, 5)" class="stat-item bg-gray-800 p-4 rounded-lg text-center border border-gray-700">
        <span class="stat-count block text-3xl font-bold text-teal-400">{{stat.count}}</span>
        <span class="stat-ingredient text-sm text-gray-400">{{stat.ingredient}}</span>
      </div>
    </div>
  </div>

  <div class="category-filters flex flex-wrap gap-3 mb-5">
    <app-button 
      (onClick)="filterByCategory(null)" 
      [variant]="selectedCategory === null ? 'default' : 'outline'"
      class="category-btn">
      All Scans
    </app-button>
    <app-button 
      *ngFor="let category of ['natural', 'artificialSweeteners', 'artificialColors', 'preservatives']"
      (onClick)="filterByCategory(category)" 
      [variant]="selectedCategory === category ? 'default' : 'outline'"
      class="category-btn">
      {{getCategoryIcon(category)}} {{category | customTitleCase}}
    </app-button>
  </div>

  <div class="products-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    <app-product-card 
      *ngFor="let product of filteredProducts"
      [product]="product"
      [isFavorite]="isFavorite(product.id)"
      [showRemoveButton]="true"
      [showShareButton]="true"
      [showAddToShoppingListButton]="true"
      [showAddToFoodDiaryButton]="true"
      (remove)="removeProduct($event)"
      (share)="shareProduct($event)"
      (addToShoppingList)="addToShoppingList($event)"
      (addToFoodDiary)="addToFoodDiary($event)"
      (toggleFavorite)="toggleFavorite($event)"
      (viewDetails)="onViewDetails($event)">
    </app-product-card>
    
    <div *ngIf="filteredProducts.length === 0" class="empty-state text-center p-10 text-gray-400 bg-gray-900/80 rounded-xl border border-gray-700 col-span-full">
      <p>No products found matching your criteria.</p>
    </div>
  </div>
</div>