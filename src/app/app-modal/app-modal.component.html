<div class="modal-overlay" [class.open]="(display$ | async) === 'open'" (click)="close()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="close()">×</button>
    
    <ng-container *ngIf="isConfirmation">
      <h3 class="modal-title">{{ modalTitle }}</h3>
      <p class="modal-message">{{ modalMessage }}</p>
      <div class="confirmation-actions">
        <button class="confirm-btn" (click)="handleConfirm()">{{ confirmButtonText }}</button>
        <button class="cancel-btn" (click)="handleCancel()">{{ cancelButtonText }}</button>
      </div>
    </ng-container>

    <ng-container *ngIf="!isConfirmation && (product$ | async) as product">
      <h3 class="modal-title">Add "{{ product.name }}"</h3>
      
      <!-- Main Actions View -->
      <div *ngIf="!showMealOptions" class="action-grid">
        <button class="action-card" (click)="addToShoppingList()">
          <span class="icon">🛒</span>
          <span class="label">Shopping List</span>
        </button>
        <button class="action-card" (click)="saveToApproved()">
          <span class="icon">❤️</span>
          <span class="label">Save to Approved</span>
        </button>
        <button class="action-card" (click)="toggleMealOptions()">
          <span class="icon">🥗</span>
          <span class="label">Food Diary</span>
        </button>
        <button class="action-card" (click)="addToAvoidList()">
          <span class="icon">🚫</span>
          <span class="label">Add to Avoided</span>
        </button>
      </div>

      <!-- Meal Selection View -->
      <div *ngIf="showMealOptions" class="meal-options">
        <h4 class="modal-subtitle">Which meal?</h4>
        <button class="meal-btn" (click)="addToDiary('Breakfast')">🍳 Breakfast</button>
        <button class="meal-btn" (click)="addToDiary('Lunch')">🥗 Lunch</button>
        <button class="meal-btn" (click)="addToDiary('Dinner')">🍲 Dinner</button>
        <button class="meal-btn" (click)="addToDiary('Snack')">🍎 Snack</button>
        <button class="meal-btn" (click)="addToDiary('Drinks')">🥤 Drinks</button>
        <button class="meal-btn back-btn" (click)="toggleMealOptions()">← Back</button>
      </div>
    </ng-container>
  </div>
</div>