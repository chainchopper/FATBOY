<div class="unified-scanner-container" [class.screen-flash]="screenFlash">
  <div class="camera-preview">
    <!-- Html5Qrcode will render its video stream inside this div -->
    <div id="reader" #reader class="barcode-reader-container"></div> 
    <canvas #canvasElement class="capture-canvas" style="display: none;"></canvas>
  </div>

  <div class="viewfinder">
    <div class="tagline">
      <span class="tagline-word">Scan.</span>
      <span class="tagline-word">Know.</span>
      <span class="tagline-word">Choose.</span>
    </div>
    <div class="scan-area" [class.stable]="isStable">
      <div *ngIf="isScanningBarcode || isProcessingOcr" class="scan-line"></div>
    </div>
    <!-- Refined text feedback logic -->
    <p *ngIf="showExpandedOptions">Scanner options open.</p>
    <p *ngIf="!showExpandedOptions && isProcessingOcr">Processing...</p>
    <p *ngIf="!showExpandedOptions && !isProcessingOcr && isScanningBarcode && !isStable">Hold steady to scan a label or barcode.</p>
    <p *ngIf="!showExpandedOptions && !isProcessingOcr && isScanningBarcode && isStable">Analyzing...</p>
    <p *ngIf="!showExpandedOptions && !isProcessingOcr && !isScanningBarcode">Nothing recognized. Hold steady to scan.</p>
  </div>

  <!-- New Immersive Footer -->
  <div class="scanner-footer">
    <div class="footer-actions-left">
      <button class="footer-btn" routerLink="/manual-entry" [class.hidden]="!showExpandedOptions">
        <lucide-icon name="edit-3" [size]="24"></lucide-icon>
        <span>Manual</span>
      </button>
      <button class="footer-btn" (click)="triggerFileUpload()" [class.hidden]="!showExpandedOptions">
        <lucide-icon name="upload" [size]="24"></lucide-icon>
        <span>Upload</span>
      </button>
      <input type="file" #fileInput style="display: none;" accept="image/*" (change)="onFileSelected($event)">
    </div>

    <button class="main-action-btn" (click)="toggleExpandedOptions()">
      <lucide-icon [name]="showExpandedOptions ? 'x' : 'plus'" [size]="36"></lucide-icon>
    </button>

    <div class="footer-actions-right">
      <button class="footer-btn" (click)="toggleVoiceListening()" [class.active]="isVoiceListening" [class.hidden]="!showExpandedOptions">
        <lucide-icon name="mic" [size]="24"></lucide-icon>
        <span>Voice</span>
      </button>
      <!-- The 'Scan' button is removed as scanning is continuous -->
    </div>
  </div>
</div>

<!-- Notifications panel, similar to app.component.html -->
<app-notifications *ngIf="showNotifications" (close)="showNotifications = false"></app-notifications>