<div class="diary-container">
  <div class="diary-header">
    <h2>Food Diary</h2>
    <div class="date-navigator">
      <button (click)="goToPreviousDay()" class="nav-button">‚óÄÔ∏è Previous Day</button>
      <span class="current-date">{{ currentDate | date:'fullDate' }} <span *ngIf="isToday()">(Today)</span></span>
      <button (click)="goToNextDay()" class="nav-button" [disabled]="isToday()">Next Day ‚ñ∂Ô∏è</button>
    </div>
  </div>

  <div class="daily-summary-section">
    <h3>Daily Performance</h3>
    <div class="summary-grid">
      <div class="summary-item">
        <span class="summary-value">{{ dailySummary.totalCalories }}</span>
        <span class="summary-label">Total Calories</span>
      </div>
      <div class="summary-item">
        <span class="summary-value">{{ dailySummary.totalFlaggedItems }}</span>
        <span class="summary-label">Flagged Ingredients</span>
      </div>
    </div>
    <div class="daily-verdict-display" [class]="'verdict-' + dailyVerdict">
      Your Day: <strong>{{ dailyVerdict | titlecase }}</strong>
    </div>
    <div *ngIf="dailySummary.totalFlaggedItems > 0" class="flagged-breakdown">
      <h4>Top Flagged:</h4>
      <ul>
        <li *ngFor="let item of (dailySummary.flaggedIngredients | keyvalue | slice:0:3)">
          {{ item.key }} ({{ item.value }} times)
        </li>
      </ul>
    </div>
  </div>

  <div class="diary-grid">
    <div class="meal-section">
      <div class="meal-header">
        <h3>üç≥ Breakfast</h3>
        <button (click)="scanForMeal('Breakfast')" class="scan-meal-btn">Scan Item</button>
      </div>
      <div *ngIf="(breakfast$ | async) as entries" class="meal-list">
        <app-product-card 
          *ngFor="let entry of entries"
          [product]="entry.product"
          [showRemoveButton]="true"
          [showShareButton]="true"
          [showAddToShoppingListButton]="true"
          (remove)="onRemoveEntry(entry.id)"
          (share)="onShareProduct($event)"
          (addToShoppingList)="onAddToShoppingList($event)">
        </app-product-card>
        <p *ngIf="entries.length === 0" class="empty-meal">No breakfast items logged.</p>
      </div>
    </div>

    <div class="meal-section">
      <div class="meal-header">
        <h3>ü•ó Lunch</h3>
        <button (click)="scanForMeal('Lunch')" class="scan-meal-btn">Scan Item</button>
      </div>
      <div *ngIf="(lunch$ | async) as entries" class="meal-list">
        <app-product-card 
          *ngFor="let entry of entries"
          [product]="entry.product"
          [showRemoveButton]="true"
          [showShareButton]="true"
          [showAddToShoppingListButton]="true"
          (remove)="onRemoveEntry(entry.id)"
          (share)="onShareProduct($event)"
          (addToShoppingList)="onAddToShoppingList($event)">
        </app-product-card>
        <p *ngIf="entries.length === 0" class="empty-meal">No lunch items logged.</p>
      </div>
    </div>

    <div class="meal-section">
      <div class="meal-header">
        <h3>üç≤ Dinner</h3>
        <button (click)="scanForMeal('Dinner')" class="scan-meal-btn">Scan Item</button>
      </div>
      <div *ngIf="(dinner$ | async) as entries" class="meal-list">
        <app-product-card 
          *ngFor="let entry of entries"
          [product]="entry.product"
          [showRemoveButton]="true"
          [showShareButton]="true"
          [showAddToShoppingListButton]="true"
          (remove)="onRemoveEntry(entry.id)"
          (share)="onShareProduct($event)"
          (addToShoppingList)="onAddToShoppingList($event)">
        </app-product-card>
        <p *ngIf="entries.length === 0" class="empty-meal">No dinner items logged.</p>
      </div>
    </div>

    <div class="meal-section">
      <div class="meal-header">
        <h3>üçé Snacks</h3>
        <button (click)="scanForMeal('Snack')" class="scan-meal-btn">Scan Item</button>
      </div>
      <div *ngIf="(snacks$ | async) as entries" class="meal-list">
        <app-product-card 
          *ngFor="let entry of entries"
          [product]="entry.product"
          [showRemoveButton]="true"
          [showShareButton]="true"
          [showAddToShoppingListButton]="true"
          (remove)="onRemoveEntry(entry.id)"
          (share)="onShareProduct($event)"
          (addToShoppingList)="onAddToShoppingList($event)">
        </app-product-card>
        <p *ngIf="entries.length === 0" class="empty-meal">No snack items logged.</p>
      </div>
    </div>

    <div class="meal-section">
      <div class="meal-header">
        <h3>ü•§ Drinks</h3>
        <button (click)="scanForMeal('Drinks')" class="scan-meal-btn">Scan Item</button>
      </div>
      <div *ngIf="(drinks$ | async) as entries" class="meal-list">
        <app-product-card 
          *ngFor="let entry of entries"
          [product]="entry.product"
          [showRemoveButton]="true"
          [showShareButton]="true"
          [showAddToShoppingListButton]="true"
          (remove)="onRemoveEntry(entry.id)"
          (share)="onShareProduct($event)"
          (addToShoppingList)="onAddToShoppingList($event)">
        </app-product-card>
        <p *ngIf="entries.length === 0" class="empty-meal">No drinks logged.</p>
      </div>
    </div>
  </div>
</div>