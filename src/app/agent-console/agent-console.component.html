<div class="console-container">
  <div class="console-header">
    <h2>ü§ñ Fat Boy Assistant</h2>
    <button (click)="clearChatHistory()" class="clear-chat-btn">Clear Chat</button>
  </div>
  <div class="message-window" #messageWindow>
    <div *ngFor="let msg of messages" class="message" [ngClass]="'message-' + msg.sender">
      <ng-container *ngIf="msg.sender === 'agent'">
        <div class="avatar-container">
          <img [src]="msg.avatar" alt="Agent Avatar" class="avatar">
          <div class="status-dot" [ngClass]="agentStatus"></div>
        </div>
        <div class="agent-content">
          <div class="message-bubble">
            <p>{{ msg.text }}</p>
            <span class="timestamp">{{ msg.timestamp | date:'shortTime' }}</span>
          </div>
          <div *ngIf="msg.suggestedPrompts && msg.suggestedPrompts.length > 0" class="suggested-prompts">
            <button *ngFor="let prompt of msg.suggestedPrompts" (click)="submitSuggestedPrompt(prompt)" class="suggested-prompt-btn">
              {{ prompt }}
            </button>
          </div>
        </div>
      </ng-container>

      <ng-container *ngIf="msg.sender === 'user'">
        <div class="message-bubble">
          <p>{{ msg.text }}</p>
          <span class="timestamp">{{ msg.timestamp | date:'shortTime' }}</span>
        </div>
        <div class="avatar-container">
          <img [src]="msg.avatar" alt="User Avatar" class="avatar">
        </div>
      </ng-container>
      
      <!-- Display human-readable tool call if present in an agent message -->
      <ng-container *ngIf="msg.sender === 'agent' && msg.toolCalls && msg.humanReadableToolCall">
        <div class="tool-call-indicator">
          ‚öôÔ∏è {{ msg.humanReadableToolCall }}
        </div>
      </ng-container>
    </div>
    <div *ngIf="isAgentTyping" class="message message-agent">
       <div class="avatar-container">
        <img [src]="agentAvatar" alt="Agent Avatar" class="avatar">
        <div class="status-dot" [ngClass]="agentStatus"></div>
      </div>
      <div class="agent-content">
        <div class="message-bubble typing-indicator">
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>
  </div>

  <div class="input-area">
    <div *ngIf="showSlashCommands" class="slash-command-popup">
      <div *ngFor="let cmd of filteredCommands" class="command-item" (click)="selectCommand(cmd)">
        <strong>{{ cmd.command }}</strong>
        <span>{{ cmd.description }}</span>
      </div>
    </div>
    <div class="input-wrapper">
      <textarea 
        [(ngModel)]="userInput" 
        (ngModelChange)="handleInput()"
        (keydown.enter)="sendMessage(); $event.preventDefault()"
        placeholder="Type a command or message..."
        class="input-field">
      </textarea>
      <button (click)="toggleVoiceListening()" class="mic-btn" [class.active]="isListening" title="Use Voice">üé§</button>
      <button (click)="sendMessage()" class="send-btn" [disabled]="!userInput.trim()">‚Üí</button>
    </div>
  </div>
</div>